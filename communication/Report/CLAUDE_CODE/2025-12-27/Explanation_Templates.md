# EXPLANATION TEMPLATES â€” "ì™œ ì´ í™•ë¥ ì¸ê°€?" ì„¤ëª… ì‹œìŠ¤í…œ

**Version**: 1.0
**Date**: 2025-12-27
**Author**: Claude Code
**Constraint**: ML ëª¨ë¸ / ì™¸ë¶€ LLM í˜¸ì¶œ ê¸ˆì§€

---

## 1. ì„¤ê³„ ì›ì¹™

### 1-A. ì„¤ëª…ì´ í•„ìš”í•œ ì´ìœ 

```
[ì‚¬ìš©ì ì‹¬ë¦¬]
"65% ìƒìŠ¹ í™•ë¥ "ì„ ë³´ë©´ ìƒê¸°ëŠ” ì§ˆë¬¸:
1. ì´ ìˆ«ìëŠ” ì–´ë””ì„œ ì™”ë‚˜?
2. ì–¼ë§ˆë‚˜ ë¯¿ì„ ìˆ˜ ìˆë‚˜?
3. ì–´ë–¤ ì¡°ê±´ì—ì„œ ê³„ì‚°ëœ ê±´ê°€?
4. ë¹„ìŠ·í•œ ìƒí™©ì´ ê³¼ê±°ì— ëª‡ ë²ˆ ìˆì—ˆë‚˜?
5. ê·¸ë•Œ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ëë‚˜?
```

### 1-B. ì„¤ëª… ì—†ëŠ” í™•ë¥ ì˜ ë¬¸ì œ

| ë¬¸ì œ | ê²°ê³¼ |
|------|------|
| ë¸”ë™ë°•ìŠ¤ | ì‹ ë¢°ë„ í•˜ë½ |
| ë§¥ë½ ë¶€ì¬ | ì˜¤í•´/ì˜¤ìš© |
| ê·¼ê±° ì—†ìŒ | "ë„ë°•" ëŠë‚Œ |
| í•œê³„ ë¯¸ê³ ì§€ | ê³¼ì‹  â†’ ì†ì‹¤ |

---

## 2. í…œí”Œë¦¿ êµ¬ì¡°

### 2-A. 4ë‹¨ê³„ ì„¤ëª… í”„ë ˆì„ì›Œí¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: í—¤ë“œë¼ì¸ (1ì¤„)                                 â”‚
â”‚  "RSI ê³¼ë§¤ë„ + MACD ê³¨ë“ í¬ë¡œìŠ¤ë¡œ ìƒìŠ¹ í™•ë¥  67%"          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Level 2: ìš”ì•½ (3ì¤„)                                     â”‚
â”‚  - í˜„ì¬ ìƒíƒœ ì§„ë‹¨                                        â”‚
â”‚  - í•µì‹¬ ê·¼ê±° 2-3ê°œ                                       â”‚
â”‚  - ì‹ ë¢°ë„/í•œê³„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Level 3: ìƒì„¸ (í¼ì¹˜ë©´ ë³´ì´ëŠ”)                           â”‚
â”‚  - ê° ì§€í‘œë³„ ê¸°ì—¬ë„                                      â”‚
â”‚  - ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€                                        â”‚
â”‚  - í¬ê¸°ë³„ í™•ë¥  ë¶„í¬                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Level 4: ì „ë¬¸ê°€ìš© (ë³„ë„ íƒ­)                             â”‚
â”‚  - ë°±í…ŒìŠ¤íŠ¸ ì „ì²´ ì§€í‘œ                                    â”‚
â”‚  - ì‹œì¥ ìƒíƒœë³„ ì¡°ê±´ë¶€ í™•ë¥                                â”‚
â”‚  - ì‹ ë¢°êµ¬ê°„/ìƒ˜í”Œ í†µê³„                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 3-A. í—¤ë“œë¼ì¸ í…œí”Œë¦¿ (Level 1)

```typescript
interface HeadlineTemplate {
  pattern: string;
  variables: string[];
  condition: (data: AnalysisData) => boolean;
}

const HEADLINE_TEMPLATES: HeadlineTemplate[] = [
  // === ê°•í•œ ìƒìŠ¹ ì‹ í˜¸ ===
  {
    pattern: "ğŸ“ˆ {indicator1} + {indicator2}ë¡œ ìƒìŠ¹ í™•ë¥  {prob}%",
    variables: ['indicator1', 'indicator2', 'prob'],
    condition: (d) => d.riseProb >= 65 && d.buySignals >= 2
  },
  {
    pattern: "ğŸš€ {count}ê°œ ì§€í‘œ ë™ì‹œ ë§¤ìˆ˜ ì‹ í˜¸! ìƒìŠ¹ í™•ë¥  {prob}%",
    variables: ['count', 'prob'],
    condition: (d) => d.buySignals >= 5
  },

  // === ê°•í•œ í•˜ë½ ì‹ í˜¸ ===
  {
    pattern: "ğŸ“‰ ê³¼ë§¤ìˆ˜ ê²½ê³ : {indicator}ê°€ {value} ë„ë‹¬, ì¡°ì • í™•ë¥  {prob}%",
    variables: ['indicator', 'value', 'prob'],
    condition: (d) => d.dropProb >= 60 && d.rsi > 70
  },

  // === íš¡ë³´/ì¤‘ë¦½ ===
  {
    pattern: "âš–ï¸ í˜¼ì¡°ì„¸: ìƒìŠ¹ {rise}% vs í•˜ë½ {drop}%, ë°©í–¥ íƒìƒ‰ ì¤‘",
    variables: ['rise', 'drop'],
    condition: (d) => Math.abs(d.riseProb - 50) < 10
  },

  // === ê³ ë³€ë™ì„± ===
  {
    pattern: "âš¡ ë³€ë™ì„± ê¸‰ë“±! ë°©í–¥ ë¶ˆëª…í™• (ì‹ ë¢°ë„ {grade}ë“±ê¸‰)",
    variables: ['grade'],
    condition: (d) => d.volatility > 5
  },

  // === íŒ¨í„´ ê¸°ë°˜ ===
  {
    pattern: "ğŸ”„ ê³¼ê±° ìœ ì‚¬ íŒ¨í„´ {count}íšŒ ì¤‘ {winCount}íšŒ ìƒìŠ¹ ({prob}%)",
    variables: ['count', 'winCount', 'prob'],
    condition: (d) => d.patternMatches > 10
  }
];

function generateHeadline(data: AnalysisData): string {
  const template = HEADLINE_TEMPLATES.find(t => t.condition(data));
  if (!template) {
    return `ë¶„ì„ ì™„ë£Œ: ìƒìŠ¹ í™•ë¥  ${data.riseProb}%`;
  }

  let result = template.pattern;
  template.variables.forEach(v => {
    result = result.replace(`{${v}}`, String(data[v]));
  });
  return result;
}
```

### 3-B. ìš”ì•½ í…œí”Œë¦¿ (Level 2)

```typescript
interface SummaryTemplate {
  id: string;
  condition: (d: AnalysisData) => boolean;
  generate: (d: AnalysisData, lang: 'ko' | 'en') => SummaryContent;
}

interface SummaryContent {
  situation: string;      // í˜„ì¬ ìƒíƒœ ì§„ë‹¨
  keyPoints: string[];    // í•µì‹¬ ê·¼ê±° (2-3ê°œ)
  confidence: string;     // ì‹ ë¢°ë„/í•œê³„
}

const SUMMARY_TEMPLATES: Record<string, SummaryTemplate> = {

  // === ê°•ë ¥ ë§¤ìˆ˜ ===
  STRONG_BUY: {
    id: 'STRONG_BUY',
    condition: (d) => d.riseProb >= 70 && d.confidence.grade === 'A',
    generate: (d, lang) => ({
      situation: lang === 'ko'
        ? `í˜„ì¬ ${d.symbol}ì€(ëŠ”) ê°•í•œ ìƒìŠ¹ ëª¨ë©˜í…€ êµ¬ê°„ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤.`
        : `${d.symbol} has entered a strong bullish momentum zone.`,

      keyPoints: lang === 'ko' ? [
        `RSI ${d.rsi.toFixed(1)}ë¡œ ê³¼ë§¤ë„ì—ì„œ ë°˜ë“± ì¤‘`,
        `MACD íˆìŠ¤í† ê·¸ë¨ ${d.macdHist > 0 ? 'ì–‘ì „í™˜' : 'ìƒìŠ¹ ì¤‘'}`,
        `ê±°ë˜ëŸ‰ ${d.volumeRatio > 1 ? 'í‰ê·  ëŒ€ë¹„ ' + (d.volumeRatio * 100 - 100).toFixed(0) + '% ì¦ê°€' : 'ì•ˆì •ì '}`
      ] : [
        `RSI at ${d.rsi.toFixed(1)}, bouncing from oversold`,
        `MACD histogram ${d.macdHist > 0 ? 'turned positive' : 'rising'}`,
        `Volume ${d.volumeRatio > 1 ? (d.volumeRatio * 100 - 100).toFixed(0) + '% above average' : 'stable'}`
      ],

      confidence: lang === 'ko'
        ? `ì‹ ë¢°ë„ ${d.confidence.grade}ë“±ê¸‰ (ê³¼ê±° ${d.sampleSize}ê±´ ë¶„ì„)`
        : `Confidence: Grade ${d.confidence.grade} (${d.sampleSize} historical samples)`
    })
  },

  // === ê³¼ë§¤ë„ ë°˜ë“± ===
  OVERSOLD_BOUNCE: {
    id: 'OVERSOLD_BOUNCE',
    condition: (d) => d.rsi < 30 && d.riseProb >= 55,
    generate: (d, lang) => ({
      situation: lang === 'ko'
        ? `${d.symbol}ì˜ RSIê°€ ${d.rsi.toFixed(1)}ë¡œ ê³¼ë§¤ë„ êµ¬ê°„ì…ë‹ˆë‹¤.`
        : `${d.symbol}'s RSI is at ${d.rsi.toFixed(1)}, in oversold territory.`,

      keyPoints: lang === 'ko' ? [
        `ê³¼ë§¤ë„(RSI<30) êµ¬ê°„ì—ì„œ ê³¼ê±° ${d.oversoldBounceRate}% í™•ë¥ ë¡œ ë°˜ë“±`,
        `í˜„ì¬ ì§€ì§€ì„  $${d.support.toLocaleString()}ì—ì„œ ${((d.currentPrice - d.support) / d.support * 100).toFixed(1)}% ìœ„`,
        d.macdCrossing ? 'MACD ê³¨ë“ í¬ë¡œìŠ¤ ì„ë°•' : 'MACD í•˜ë½ì„¸ ë‘”í™” ì¤‘'
      ] : [
        `Historically, ${d.oversoldBounceRate}% bounce from oversold (RSI<30)`,
        `Currently ${((d.currentPrice - d.support) / d.support * 100).toFixed(1)}% above support at $${d.support.toLocaleString()}`,
        d.macdCrossing ? 'MACD golden cross imminent' : 'MACD decline slowing'
      ],

      confidence: lang === 'ko'
        ? `ë‹¨, ì¶”ì„¸ í•˜ë½ ì¤‘ì´ë©´ ì¶”ê°€ í•˜ë½ ${100 - d.riseProb}% ê°€ëŠ¥`
        : `Caution: ${100 - d.riseProb}% chance of further decline if downtrend continues`
    })
  },

  // === ê³¼ë§¤ìˆ˜ ê²½ê³  ===
  OVERBOUGHT_WARNING: {
    id: 'OVERBOUGHT_WARNING',
    condition: (d) => d.rsi > 70,
    generate: (d, lang) => ({
      situation: lang === 'ko'
        ? `âš ï¸ ${d.symbol}ì˜ RSIê°€ ${d.rsi.toFixed(1)}ë¡œ ê³¼ë§¤ìˆ˜ êµ¬ê°„ì…ë‹ˆë‹¤.`
        : `âš ï¸ ${d.symbol}'s RSI is at ${d.rsi.toFixed(1)}, in overbought territory.`,

      keyPoints: lang === 'ko' ? [
        `ê³¼ë§¤ìˆ˜(RSI>70) í›„ ê³¼ê±° ${d.overboughtDropRate}% í™•ë¥ ë¡œ ì¡°ì • ë°œìƒ`,
        `ë³¼ë¦°ì € ìƒë‹¨ ë°´ë“œ ê·¼ì ‘ (í˜„ì¬ê°€ê°€ ë°´ë“œì˜ ${d.bbPosition}% ìœ„ì¹˜)`,
        `ë‹¨ê¸° ì°¨ìµì‹¤í˜„ ì••ë ¥ ì˜ˆìƒ`
      ] : [
        `Historically, ${d.overboughtDropRate}% correction after overbought (RSI>70)`,
        `Near upper Bollinger Band (price at ${d.bbPosition}% of band)`,
        `Short-term profit-taking pressure expected`
      ],

      confidence: lang === 'ko'
        ? `ê°•í•œ ìƒìŠ¹ ì¶”ì„¸ì—ì„œëŠ” ê³¼ë§¤ìˆ˜ ìƒíƒœê°€ ì§€ì†ë  ìˆ˜ ìˆìŒ`
        : `Note: Overbought can persist in strong uptrends`
    })
  },

  // === íš¡ë³´ ===
  RANGING: {
    id: 'RANGING',
    condition: (d) => d.regime === 'RANGING_TIGHT' || d.regime === 'RANGING_WIDE',
    generate: (d, lang) => ({
      situation: lang === 'ko'
        ? `${d.symbol}ì€(ëŠ”) í˜„ì¬ $${d.support.toLocaleString()} ~ $${d.resistance.toLocaleString()} ë°•ìŠ¤ê¶Œ íš¡ë³´ ì¤‘ì…ë‹ˆë‹¤.`
        : `${d.symbol} is ranging between $${d.support.toLocaleString()} and $${d.resistance.toLocaleString()}.`,

      keyPoints: lang === 'ko' ? [
        `ADX ${d.adx.toFixed(1)}ë¡œ ì¶”ì„¸ ì•½í•¨`,
        `ë³¼ë¦°ì € ë°´ë“œ í­ ${d.bbWidth.toFixed(1)}%ë¡œ ë³€ë™ì„± ì¶•ì†Œ`,
        `ëŒíŒŒ ë°©í–¥ ì£¼ì‹œ í•„ìš”`
      ] : [
        `ADX at ${d.adx.toFixed(1)}, indicating weak trend`,
        `Bollinger Band width ${d.bbWidth.toFixed(1)}%, volatility contracting`,
        `Watch for breakout direction`
      ],

      confidence: lang === 'ko'
        ? `íš¡ë³´ì¥ì—ì„œ ì¶”ì„¸ ì§€í‘œ ì‹ ë¢°ë„ ë‚®ìŒ (ì—­ì¶”ì„¸ ì§€í‘œ ì°¸ê³ )`
        : `Trend indicators less reliable in ranging markets (use mean-reversion)`
    })
  },

  // === ê³ ë³€ë™ì„± ===
  HIGH_VOLATILITY: {
    id: 'HIGH_VOLATILITY',
    condition: (d) => d.atrPercent > 5,
    generate: (d, lang) => ({
      situation: lang === 'ko'
        ? `âš¡ ${d.symbol}ì˜ ë³€ë™ì„±ì´ í‰ì†Œì˜ ${(d.atrPercent / d.avgAtrPercent * 100).toFixed(0)}% ìˆ˜ì¤€ìœ¼ë¡œ ê¸‰ë“±í–ˆìŠµë‹ˆë‹¤.`
        : `âš¡ ${d.symbol}'s volatility has spiked to ${(d.atrPercent / d.avgAtrPercent * 100).toFixed(0)}% of normal levels.`,

      keyPoints: lang === 'ko' ? [
        `ATR ${d.atrPercent.toFixed(1)}% (ì¼ë°˜ì  ${d.avgAtrPercent.toFixed(1)}%)`,
        `ê¸‰ê²©í•œ ë°©í–¥ ì „í™˜ ê°€ëŠ¥ì„± ë†’ìŒ`,
        `ì†ì ˆ í­ í™•ëŒ€ í•„ìš”`
      ] : [
        `ATR ${d.atrPercent.toFixed(1)}% (normal: ${d.avgAtrPercent.toFixed(1)}%)`,
        `High probability of sudden direction changes`,
        `Wider stop-loss recommended`
      ],

      confidence: lang === 'ko'
        ? `ğŸ”´ ê³ ë³€ë™ì„±ìœ¼ë¡œ ëª¨ë“  ì˜ˆì¸¡ ì‹ ë¢°ë„ í•˜ë½. í¬ì§€ì…˜ ì¶•ì†Œ ê¶Œì¥.`
        : `ğŸ”´ All predictions less reliable in high volatility. Reduce position size.`
    })
  }
};

function generateSummary(data: AnalysisData, lang: 'ko' | 'en'): SummaryContent {
  for (const template of Object.values(SUMMARY_TEMPLATES)) {
    if (template.condition(data)) {
      return template.generate(data, lang);
    }
  }
  // ê¸°ë³¸ í…œí”Œë¦¿
  return {
    situation: lang === 'ko'
      ? `${data.symbol} ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`
      : `Analysis complete for ${data.symbol}.`,
    keyPoints: [],
    confidence: ''
  };
}
```

### 3-C. ìƒì„¸ ì„¤ëª… í…œí”Œë¦¿ (Level 3)

```typescript
interface DetailedExplanation {
  indicatorBreakdown: IndicatorContribution[];
  historicalCases: HistoricalCase[];
  magnitudeDistribution: MagnitudeDistribution;
  caveats: string[];
}

interface IndicatorContribution {
  name: string;
  value: number;
  signal: 'BUY' | 'SELL' | 'NEUTRAL';
  contribution: number;      // -10 ~ +10
  explanation: string;
}

function generateDetailedExplanation(
  data: AnalysisData,
  lang: 'ko' | 'en'
): DetailedExplanation {

  // ì§€í‘œë³„ ê¸°ì—¬ë„
  const indicatorBreakdown: IndicatorContribution[] = [
    {
      name: 'RSI (14)',
      value: data.rsi,
      signal: data.rsi < 30 ? 'BUY' : data.rsi > 70 ? 'SELL' : 'NEUTRAL',
      contribution: data.rsi < 30 ? 8 : data.rsi > 70 ? -8 : 0,
      explanation: lang === 'ko'
        ? `RSI ${data.rsi.toFixed(1)} - ${data.rsi < 30 ? 'ê³¼ë§¤ë„ë¡œ ë°˜ë“± ê¸°ëŒ€' : data.rsi > 70 ? 'ê³¼ë§¤ìˆ˜ë¡œ ì¡°ì • ì˜ˆìƒ' : 'ì¤‘ë¦½ êµ¬ê°„'}`
        : `RSI ${data.rsi.toFixed(1)} - ${data.rsi < 30 ? 'Oversold, bounce expected' : data.rsi > 70 ? 'Overbought, correction expected' : 'Neutral zone'}`
    },
    {
      name: 'MACD',
      value: data.macdHist,
      signal: data.macdHist > 0 ? 'BUY' : data.macdHist < 0 ? 'SELL' : 'NEUTRAL',
      contribution: Math.sign(data.macdHist) * Math.min(Math.abs(data.macdHist) * 10, 7),
      explanation: lang === 'ko'
        ? `MACD íˆìŠ¤í† ê·¸ë¨ ${data.macdHist > 0 ? 'ì–‘ìˆ˜ (ìƒìŠ¹ ëª¨ë©˜í…€)' : 'ìŒìˆ˜ (í•˜ë½ ëª¨ë©˜í…€)'}`
        : `MACD histogram ${data.macdHist > 0 ? 'positive (bullish momentum)' : 'negative (bearish momentum)'}`
    },
    // ... ë‚˜ë¨¸ì§€ ì§€í‘œë“¤
  ];

  // ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€
  const historicalCases: HistoricalCase[] = data.topMatches.slice(0, 5).map(match => ({
    date: match.date,
    similarity: match.similarity,
    outcome: match.returnPct,
    description: lang === 'ko'
      ? `${match.date}: ìœ ì‚¬ë„ ${match.similarity}% â†’ ${match.returnPct > 0 ? '+' : ''}${match.returnPct.toFixed(1)}%`
      : `${match.date}: ${match.similarity}% similar â†’ ${match.returnPct > 0 ? '+' : ''}${match.returnPct.toFixed(1)}%`
  }));

  // í¬ê¸°ë³„ ë¶„í¬
  const magnitudeDistribution = {
    labels: lang === 'ko'
      ? ['3%+ ìƒìŠ¹', '1-3% ìƒìŠ¹', '0-1% ìƒìŠ¹', '0-1% í•˜ë½', '1-3% í•˜ë½', '3%+ í•˜ë½']
      : ['+3%+ Rise', '+1-3% Rise', '+0-1% Rise', '0-1% Drop', '1-3% Drop', '3%+ Drop'],
    values: [
      data.magnitude.strongRise,
      data.magnitude.moderateRise,
      data.magnitude.slightRise,
      data.magnitude.slightDrop,
      data.magnitude.moderateDrop,
      data.magnitude.strongDrop
    ]
  };

  // ì£¼ì˜ì‚¬í•­
  const caveats: string[] = [];

  if (data.sampleSize < 30) {
    caveats.push(lang === 'ko'
      ? `âš ï¸ í‘œë³¸ ìˆ˜(${data.sampleSize}ê°œ)ê°€ ì ì–´ í†µê³„ì  ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤.`
      : `âš ï¸ Sample size (${data.sampleSize}) is small, statistical confidence is low.`
    );
  }

  if (data.atrPercent > 4) {
    caveats.push(lang === 'ko'
      ? `âš ï¸ í˜„ì¬ ë³€ë™ì„±(${data.atrPercent.toFixed(1)}%)ì´ ë†’ì•„ ì˜ˆì¸¡ ë¶ˆí™•ì‹¤ì„±ì´ í½ë‹ˆë‹¤.`
      : `âš ï¸ Current volatility (${data.atrPercent.toFixed(1)}%) is high, prediction uncertainty increased.`
    );
  }

  if (data.regime !== data.historicalRegime) {
    caveats.push(lang === 'ko'
      ? `âš ï¸ í˜„ì¬ ì‹œì¥ ìƒíƒœ(${data.regime})ê°€ ê³¼ê±° íŒ¨í„´ ì‹œì ê³¼ ë‹¤ë¦…ë‹ˆë‹¤.`
      : `âš ï¸ Current market regime (${data.regime}) differs from historical pattern periods.`
    );
  }

  return {
    indicatorBreakdown,
    historicalCases,
    magnitudeDistribution,
    caveats
  };
}
```

---

## 4. UI ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### 4-A. ì„¤ëª… ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

```tsx
// components/Analysis/ProbabilityExplanation.tsx

interface Props {
  data: AnalysisData;
  lang: 'ko' | 'en';
  defaultLevel?: 1 | 2 | 3;
}

export const ProbabilityExplanation: React.FC<Props> = ({
  data,
  lang,
  defaultLevel = 2
}) => {
  const [level, setLevel] = useState(defaultLevel);

  const headline = generateHeadline(data);
  const summary = generateSummary(data, lang);
  const detailed = generateDetailedExplanation(data, lang);

  return (
    <div className="bg-gray-900 rounded-xl border border-gray-800 overflow-hidden">
      {/* Level 1: í—¤ë“œë¼ì¸ (í•­ìƒ í‘œì‹œ) */}
      <div className="p-4 bg-gradient-to-r from-gray-800 to-gray-900">
        <h3 className="text-lg font-bold text-white flex items-center gap-2">
          {headline}
          <ConfidenceBadge grade={data.confidence.grade} />
        </h3>
      </div>

      {/* Level 2: ìš”ì•½ (ê¸°ë³¸ í‘œì‹œ) */}
      <div className="p-4 border-t border-gray-800">
        <p className="text-gray-300 mb-3">{summary.situation}</p>

        <ul className="space-y-2">
          {summary.keyPoints.map((point, i) => (
            <li key={i} className="flex items-start gap-2 text-sm text-gray-400">
              <span className="text-blue-400">â€¢</span>
              {point}
            </li>
          ))}
        </ul>

        <p className="mt-3 text-xs text-gray-500 italic">
          {summary.confidence}
        </p>
      </div>

      {/* Level 3: ìƒì„¸ (í¼ì¹˜ê¸°) */}
      <Collapsible>
        <CollapsibleTrigger className="w-full p-3 text-sm text-gray-400 hover:text-white flex items-center justify-center gap-2 border-t border-gray-800">
          {lang === 'ko' ? 'ìƒì„¸ ë¶„ì„ ë³´ê¸°' : 'View Detailed Analysis'}
          <ChevronDown className="h-4 w-4" />
        </CollapsibleTrigger>

        <CollapsibleContent className="p-4 border-t border-gray-800 space-y-6">
          {/* ì§€í‘œë³„ ê¸°ì—¬ë„ */}
          <section>
            <h4 className="text-sm font-bold text-gray-300 mb-3">
              {lang === 'ko' ? 'ğŸ“Š ì§€í‘œë³„ ê¸°ì—¬ë„' : 'ğŸ“Š Indicator Contributions'}
            </h4>
            <div className="space-y-2">
              {detailed.indicatorBreakdown.map(ind => (
                <IndicatorBar
                  key={ind.name}
                  name={ind.name}
                  value={ind.value}
                  signal={ind.signal}
                  contribution={ind.contribution}
                  explanation={ind.explanation}
                />
              ))}
            </div>
          </section>

          {/* ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€ */}
          <section>
            <h4 className="text-sm font-bold text-gray-300 mb-3">
              {lang === 'ko' ? 'ğŸ“œ ê³¼ê±° ìœ ì‚¬ ì‚¬ë¡€' : 'ğŸ“œ Historical Similar Cases'}
            </h4>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
              {detailed.historicalCases.map((c, i) => (
                <HistoricalCaseCard key={i} case={c} />
              ))}
            </div>
          </section>

          {/* í¬ê¸°ë³„ ë¶„í¬ */}
          <section>
            <h4 className="text-sm font-bold text-gray-300 mb-3">
              {lang === 'ko' ? 'ğŸ“ˆ ì˜ˆìƒ ìˆ˜ìµë¥  ë¶„í¬' : 'ğŸ“ˆ Expected Return Distribution'}
            </h4>
            <MagnitudeChart data={detailed.magnitudeDistribution} />
          </section>

          {/* ì£¼ì˜ì‚¬í•­ */}
          {detailed.caveats.length > 0 && (
            <section className="bg-yellow-900/20 border border-yellow-700/30 rounded-lg p-3">
              <h4 className="text-sm font-bold text-yellow-400 mb-2">
                {lang === 'ko' ? 'âš ï¸ ì£¼ì˜ì‚¬í•­' : 'âš ï¸ Caveats'}
              </h4>
              <ul className="space-y-1 text-xs text-yellow-300/80">
                {detailed.caveats.map((c, i) => (
                  <li key={i}>{c}</li>
                ))}
              </ul>
            </section>
          )}
        </CollapsibleContent>
      </Collapsible>
    </div>
  );
};
```

### 4-B. ì§€í‘œ ê¸°ì—¬ë„ ë°”

```tsx
const IndicatorBar: React.FC<{
  name: string;
  value: number;
  signal: 'BUY' | 'SELL' | 'NEUTRAL';
  contribution: number;  // -10 ~ +10
  explanation: string;
}> = ({ name, value, signal, contribution, explanation }) => {
  const barColor = signal === 'BUY' ? 'bg-green-500' :
                   signal === 'SELL' ? 'bg-red-500' : 'bg-gray-500';

  const barWidth = Math.abs(contribution) * 5;  // 0-50%

  return (
    <div className="flex items-center gap-3 p-2 bg-gray-800/50 rounded">
      {/* ì§€í‘œëª… */}
      <div className="w-24 text-xs font-mono text-gray-400">{name}</div>

      {/* ê°’ */}
      <div className="w-16 text-xs text-gray-300">{value.toFixed(1)}</div>

      {/* ê¸°ì—¬ë„ ë°” */}
      <div className="flex-1 h-2 bg-gray-700 rounded-full relative">
        <div
          className={`absolute top-0 h-full rounded-full ${barColor}`}
          style={{
            left: contribution >= 0 ? '50%' : `${50 - barWidth}%`,
            width: `${barWidth}%`
          }}
        />
        <div className="absolute left-1/2 top-0 h-full w-px bg-gray-500" />
      </div>

      {/* ì‹œê·¸ë„ */}
      <div className={`w-12 text-xs font-bold text-center ${
        signal === 'BUY' ? 'text-green-400' :
        signal === 'SELL' ? 'text-red-400' : 'text-gray-400'
      }`}>
        {signal}
      </div>

      {/* íˆ´íŒ */}
      <Tooltip content={explanation}>
        <Info className="h-4 w-4 text-gray-500 cursor-help" />
      </Tooltip>
    </div>
  );
};
```

---

## 5. ë™ì  ë¬¸ì¥ ìƒì„± ê·œì¹™

### 5-A. ì¡°ê±´ë¶€ ë¬¸ì¥ ì¡°í•©

```typescript
type ConditionKey =
  | 'RSI_OVERSOLD'
  | 'RSI_OVERBOUGHT'
  | 'MACD_GOLDEN'
  | 'MACD_DEAD'
  | 'BB_LOWER_TOUCH'
  | 'BB_UPPER_TOUCH'
  | 'VOLUME_SURGE'
  | 'HIGH_VOLATILITY'
  | 'STRONG_TREND'
  | 'WEAK_TREND';

const CONDITION_PHRASES: Record<ConditionKey, { ko: string; en: string }> = {
  RSI_OVERSOLD: {
    ko: 'RSIê°€ ê³¼ë§¤ë„ êµ¬ê°„({value})ì—ì„œ',
    en: 'With RSI in oversold territory ({value}),'
  },
  RSI_OVERBOUGHT: {
    ko: 'RSIê°€ ê³¼ë§¤ìˆ˜ êµ¬ê°„({value})ìœ¼ë¡œ',
    en: 'With RSI in overbought territory ({value}),'
  },
  MACD_GOLDEN: {
    ko: 'MACD ê³¨ë“ í¬ë¡œìŠ¤ê°€ ë°œìƒí•˜ì—¬',
    en: 'with MACD golden cross occurring,'
  },
  MACD_DEAD: {
    ko: 'MACD ë°ë“œí¬ë¡œìŠ¤ê°€ ë°œìƒí•˜ì—¬',
    en: 'with MACD death cross occurring,'
  },
  BB_LOWER_TOUCH: {
    ko: 'ë³¼ë¦°ì € í•˜ë‹¨ ë°´ë“œì— ë‹¿ì•„',
    en: 'touching the lower Bollinger Band,'
  },
  BB_UPPER_TOUCH: {
    ko: 'ë³¼ë¦°ì € ìƒë‹¨ ë°´ë“œì— ë‹¿ì•„',
    en: 'touching the upper Bollinger Band,'
  },
  VOLUME_SURGE: {
    ko: 'ê±°ë˜ëŸ‰ì´ í‰ê·  ëŒ€ë¹„ {ratio}% ê¸‰ì¦í•˜ë©°',
    en: 'with volume surging {ratio}% above average,'
  },
  HIGH_VOLATILITY: {
    ko: 'ê³ ë³€ë™ì„± í™˜ê²½ì—ì„œ',
    en: 'in a high-volatility environment,'
  },
  STRONG_TREND: {
    ko: 'ê°•í•œ ì¶”ì„¸ê°€ í™•ì¸ë˜ì–´',
    en: 'with a strong trend confirmed,'
  },
  WEAK_TREND: {
    ko: 'ì¶”ì„¸ê°€ ì•½í•´ì§€ëŠ” ê°€ìš´ë°',
    en: 'amid weakening trend,'
  }
};

function buildDynamicSentence(
  conditions: ConditionKey[],
  probability: number,
  lang: 'ko' | 'en',
  variables: Record<string, string | number>
): string {
  const phrases = conditions.map(c => {
    let phrase = CONDITION_PHRASES[c][lang];
    Object.entries(variables).forEach(([key, value]) => {
      phrase = phrase.replace(`{${key}}`, String(value));
    });
    return phrase;
  });

  const conclusion = lang === 'ko'
    ? `ìƒìŠ¹ í™•ë¥ ì€ ${probability}%ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.`
    : `the probability of rise is analyzed at ${probability}%.`;

  return phrases.join(' ') + ' ' + conclusion;
}

// ì‚¬ìš© ì˜ˆì‹œ
buildDynamicSentence(
  ['RSI_OVERSOLD', 'MACD_GOLDEN', 'VOLUME_SURGE'],
  72,
  'ko',
  { value: 28.5, ratio: 150 }
);
// â†’ "RSIê°€ ê³¼ë§¤ë„ êµ¬ê°„(28.5)ì—ì„œ MACD ê³¨ë“ í¬ë¡œìŠ¤ê°€ ë°œìƒí•˜ì—¬ ê±°ë˜ëŸ‰ì´ í‰ê·  ëŒ€ë¹„ 150% ê¸‰ì¦í•˜ë©° ìƒìŠ¹ í™•ë¥ ì€ 72%ë¡œ ë¶„ì„ë©ë‹ˆë‹¤."
```

---

## 6. ê²°ë¡  ë¬¸ì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 6-A. í™•ë¥  ë²”ìœ„ë³„ ê²°ë¡ 

```typescript
const CONCLUSIONS: Record<string, { ko: string; en: string }[]> = {
  VERY_HIGH: [ // 75%+
    {
      ko: 'ì—­ì‚¬ì ìœ¼ë¡œ ì´ ì¡°í•©ì—ì„œëŠ” ë†’ì€ í™•ë¥ ë¡œ ìƒìŠ¹ì´ ì´ì–´ì¡ŒìŠµë‹ˆë‹¤.',
      en: 'Historically, this combination has led to rises with high probability.'
    },
    {
      ko: 'í˜„ì¬ ìƒí™©ì€ ë§¤ìˆ˜ì— ìœ ë¦¬í•œ í™˜ê²½ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.',
      en: 'Current conditions appear favorable for buying.'
    }
  ],
  HIGH: [ // 60-75%
    {
      ko: 'ìƒìŠ¹ ê°€ëŠ¥ì„±ì´ ë†’ì§€ë§Œ, ë¦¬ìŠ¤í¬ ê´€ë¦¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.',
      en: 'High probability of rise, but risk management is essential.'
    },
    {
      ko: 'ë¶„í•  ë§¤ìˆ˜ ì „ëµì´ ì í•©í•´ ë³´ì…ë‹ˆë‹¤.',
      en: 'A DCA (split entry) strategy seems appropriate.'
    }
  ],
  NEUTRAL: [ // 45-60%
    {
      ko: 'ë°©í–¥ì„±ì´ ë¶ˆë¶„ëª…í•˜ë¯€ë¡œ ê´€ë§ì„ ê¶Œí•©ë‹ˆë‹¤.',
      en: 'Direction is unclear; staying on the sidelines is recommended.'
    },
    {
      ko: 'í™•ì‹¤í•œ ì‹ í˜¸ê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.',
      en: 'Better to wait for a clearer signal.'
    }
  ],
  LOW: [ // 35-45%
    {
      ko: 'í•˜ë½ ì••ë ¥ì´ ìš°ì„¸í•œ ìƒí™©ì…ë‹ˆë‹¤. ì‹ ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤.',
      en: 'Downward pressure prevails. Caution is advised.'
    },
    {
      ko: 'ë§¤ìˆ˜ë³´ë‹¤ëŠ” í˜„ê¸ˆ ë³´ìœ ê°€ ë‚˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      en: 'Holding cash may be preferable to buying.'
    }
  ],
  VERY_LOW: [ // <35%
    {
      ko: 'ë§¤ìˆ˜ ì‹œê·¸ë„ì´ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€ í•˜ë½ì— ì£¼ì˜í•˜ì„¸ìš”.',
      en: 'No buy signals. Beware of further decline.'
    },
    {
      ko: 'ë‹¨ê¸° íŠ¸ë ˆì´ë”ë¼ë©´ ìˆ í¬ì§€ì…˜ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      en: 'Short-term traders may consider short positions.'
    }
  ]
};

function getConclusion(probability: number, lang: 'ko' | 'en'): string {
  const tier = probability >= 75 ? 'VERY_HIGH' :
               probability >= 60 ? 'HIGH' :
               probability >= 45 ? 'NEUTRAL' :
               probability >= 35 ? 'LOW' : 'VERY_LOW';

  const options = CONCLUSIONS[tier];
  return options[Math.floor(Math.random() * options.length)][lang];
}
```

---

## 7. íŒŒì¼ êµ¬ì¡°

```
lib/
â”œâ”€â”€ explanation/
â”‚   â”œâ”€â”€ templates.ts        # í…œí”Œë¦¿ ì •ì˜
â”‚   â”œâ”€â”€ generator.ts        # ë¬¸ì¥ ìƒì„±ê¸°
â”‚   â”œâ”€â”€ conditions.ts       # ì¡°ê±´ ë¬¸êµ¬
â”‚   â””â”€â”€ conclusions.ts      # ê²°ë¡  ë¼ì´ë¸ŒëŸ¬ë¦¬
â”œâ”€â”€ types/
â”‚   â””â”€â”€ explanation.ts      # íƒ€ì… ì •ì˜
components/
â”œâ”€â”€ Analysis/
â”‚   â”œâ”€â”€ ProbabilityExplanation.tsx
â”‚   â”œâ”€â”€ IndicatorBar.tsx
â”‚   â”œâ”€â”€ HistoricalCaseCard.tsx
â”‚   â””â”€â”€ MagnitudeChart.tsx
```

---

**Status**: DESIGN COMPLETE
**Next**: Commander ìŠ¹ì¸ â†’ êµ¬í˜„
