폴리 에이전트 오케스트레이션 아키텍처: Claude Code의 헤드리스 DevOps 엔지니어 구현 및 Google Antigravity 통합 연구 보고서
1. 서론: 에이전트 기반 DevOps(Agentic DevOps)로의 패러다임 전환
소프트웨어 개발 수명 주기(SDLC)는 인간 중심의 운영 방식인 'ChatOps'에서 자율적인 AI 에이전트가 인프라를 관리하고 코드를 배포하며 시스템을 복구하는 'AgentOps'로 근본적인 패러다임 전환을 겪고 있다. 이 새로운 아키텍처에서 DevOps 엔지니어의 역할은 반복적인 작업을 수행하는 실행자에서, 자율 에이전트(Autonomous Agents)들의 오케스트레이터이자 감독자로 변화하고 있다. 본 연구 보고서는 Anthropic의 Claude Code를 '헤드리스 DevOps 엔지니어(Headless DevOps Engineer)'로 설정하여, Google Antigravity와 같은 고도화된 에이전트 오케스트레이션 플랫폼 내에서 자율적으로 기능하게 만드는 기술적 방법론을 심층적으로 다룬다.
기존의 AI 코딩 도구들이 IDE(통합 개발 환경) 내에서 개발자의 보조적인 역할(Copilot)에 머물렀다면, 차세대 에이전트 아키텍처는 인간의 직접적인 개입 없이 백그라운드에서 실행되는 '헤드리스(Headless)' 런타임을 요구한다. 이는 마치 리눅스의 데몬(Daemon) 프로세스처럼, 저장소를 감시하고 테라폼(Terraform) 상태를 관리하며 클라우드 공급자와 상호작용하는 독립적인 실체로서의 AI를 의미한다.
본 보고서는 Claude Code의 CLI(Command Line Interface)를 비대화형(Non-interactive) 모드로 전환하는 기술적 조치, 에이전트의 인지 아키텍처를 정의하는 CLAUDE.md의 구성 전략, 시스템의 안전 장치인 config.json 및 settings.json의 보안 설정, 그리고 외부 시스템과의 연결을 담당하는 모델 컨텍스트 프로토콜(MCP)의 통합 방안을 망라한다. 또한, Google Antigravity의 '미션 컨트롤(Mission Control)' 인터페이스와 연동하여 다중 에이전트(Poly-Agent)가 협업하는 워크플로우를 구체적으로 설계한다.
2. 헤드리스 런타임 아키텍처: Claude Code CLI의 심층 분석
Claude Code를 단순한 챗봇이 아닌 자율적인 DevOps 엔지니어로 전환하기 위해서는 그 실행 환경인 CLI 런타임에 대한 깊은 이해가 선행되어야 한다. 일반적인 개발자가 사용하는 대화형 REPL(Read-Eval-Print Loop) 모드와 달리, 헤드리스 모드는 스크립트 기반의 자동화, CI/CD 파이프라인 내 통합, 그리고 타 에이전트에 의한 호출을 전제로 설계된다.
2.1 비대화형(Non-Interactive) 실행 모델과 CLI 플래그 전략
헤드리스 DevOps 엔지니어 구현의 핵심은 -p (print) 플래그와 비대화형 제어 플래그들의 조합에 있다. 표준적인 워크플로우에서 사용자는 터미널 창을 열고 Claude에게 질문을 던지지만, 자동화된 DevOps 에이전트는 쉘 스크립트, GitHub Actions 러너(Runner), 또는 도커 컨테이너 내부에서 인간의 입력 없이 작동해야 한다.1
claude -p "prompt" 명령어 구조는 단일 턴(Single-turn) 실행을 가능하게 하지만, 쿠버네티스(Kubernetes) 배포 실패 원인을 진단하거나 복잡한 인프라 마이그레이션을 수행하는 DevOps 작업은 다중 턴(Multi-turn) 추론과 상태 유지를 필요로 한다. 따라서 아키텍처는 --continue 플래그나 세션 재개 기능(-r)을 활용하여 실행 단계 간의 컨텍스트를 유지해야 한다.
다음은 헤드리스 DevOps 설정을 위한 필수 CLI 플래그와 그 전략적 의미를 분석한 표이다.
표 1: 헤드리스 DevOps 구성을 위한 Claude Code CLI 플래그 심층 분석


플래그 (Flag)
	기능 (Function)
	DevOps 유스케이스 및 전략적 가치
	위험도 및 제어 방안
	-p "query"
	프린트 모드 (Print Mode)
	단일 프롬프트를 실행하고 종료한다. 로그 분석이나 상태 확인과 같은 'Fire-and-Forget' 작업에 사용된다. 스크립트 내에서 변수화된 입력을 주입하기에 이상적이다.
	낮음
	--dangerously-skip-permissions
	권한 우회 (Permission Bypass)
	자율성의 핵심. 에이전트가 kubectl apply나 terraform apply와 같은 명령어를 실행할 때 사용자 승인을 기다리며 중단되는(hanging) 현상을 방지한다.2
	치명적 (Critical)


샌드박스 환경 필수
	--allowedTools
	도구 화이트리스팅
	권한 우회의 안전한 대안. 예: --allowedTools "Read,Bash(git*),Bash(terraform plan)". 모든 권한을 우회하는 것보다 훨씬 정밀한 제어가 가능하다.
	중간
	--output-format json
	구조화된 출력
	에이전트의 추론 결과를 다운스트림 도구(예: PagerDuty 알림 트리거, Jira 티켓 생성)로 파이핑하기 위해 필수적이다. 텍스트 파싱의 모호함을 제거한다.3
	낮음
	--max-turns
	비용 및 루프 제어
	에이전트가 인프라 오류를 해결하지 못하고 무한 루프에 빠져 API 비용을 과다 청구하는 것을 방지한다.2
	낮음
	--dangerously-skip-permissions 플래그는 진정한 의미의 자율 DevOps 엔지니어를 구현하는 데 있어 린치핀(Linchpin) 역할을 한다.3 이 플래그 없이는 에이전트가 terraform apply 명령을 내리기 직전, 존재하지 않는 인간의 승인을 기다리며 무기한 대기 상태에 빠지게 되어 헤드리스 운영의 목적을 무색하게 만든다. 그러나 이 플래그의 사용은 에이전트가 프로덕션 리소스를 실수로 삭제할 수 있는 위험을 내포하므로, 10장에서 논의할 엄격한 '샌드박스(Sandbox)' 환경과 결합되어야만 한다.
2.2 세션 관리 및 영속성 (Persistence) 메커니즘
인간 엔지니어는 인프라의 과거 상태와 히스토리를 기억한다. 그러나 표준적인 CLI 실행은 일시적(Ephemeral)이다. '기억을 가진' 헤드리스 엔지니어를 구현하기 위해서는 세션 관리 래퍼(Wrapper)를 구현해야 한다.
연구에 따르면, 지속적인 세션 ID와 함께 -r (resume) 플래그를 사용하는 것이 가장 효과적이다.4 쉘 스크립트나 파이썬 컨트롤러는 다음과 같은 로직을 수행해야 한다:
1. 세션 초기화: 특정 티켓이나 작업 ID(예: incident-402)와 연동된 유니크 세션 ID를 생성한다.
2. 세션 저장: 이 ID를 로컬 파일이나 데이터베이스에 저장한다.
3. 컨텍스트 재개: 후속 작업 실행 시 claude -r "incident-402" -p "로그 확인 결과 분석" 명령을 통해 이전 대화의 맥락을 불러온다.
이러한 영속성(Persistence)은 에이전트가 "아까 로드 밸런서 로그를 확인했으니, 이제 데이터베이스 로그를 볼 차례다"라는 식의 연역적 추론을 가능하게 하며, 이는 문제 해결의 연속성을 보장하는 핵심 메커니즘이다.1
2.3 트리거(Trigger) 및 감시(Watch) 아키텍처
Claude Code는 기본적으로 파일 시스템을 무한히 감시하는 '데몬' 모드를 내장하고 있지 않다. 이는 요청-응답(Request-Response) 엔진이다. 따라서 "빌드가 실패하면 고쳐라"와 같은 반응형(Reactive) DevOps 엔지니어로 기능하기 위해서는 외부 이벤트에 의한 트리거 메커니즘이 필요하다.
헤드리스 Claude를 트리거하는 세 가지 주요 아키텍처 패턴은 다음과 같다:
1. CI/CD 파이프라인 통합 (Pipeline Integration): 가장 단순하면서도 강력한 방법은 GitHub Actions의 yaml 파일 내에 claude -p 명령을 임베딩하는 것이다. 테스트 단계가 실패하면, 파이프라인은 오류 로그를 캡처하여 Claude에게 전달하고, Claude는 수정 패치를 생성하여 PR을 올린다.3
2. 파일 시스템 감시 (File System Watching): entr, chokidar, 또는 리눅스의 inotify와 같은 도구를 사용하여 특정 디렉토리(예: /var/log/syslog 또는 지시사항 파일 instructions.md)를 감시한다. 변경이 감지되면 감시 데몬이 Claude CLI를 트리거하여 파일을 읽고 조치를 취하게 한다.5
3. MCP 서버 푸시 (MCP Server Push): 가장 진보된 아키텍처로, Claude를 단순한 클라이언트가 아닌 MCP 서버로 구동하여 외부 오케스트레이터(Google Antigravity 등)가 Claude 프로세스에 요청을 보내는 방식이다. 이는 Claude를 일종의 마이크로서비스(Microservice)로 취급하는 것이다.7
3. 인지 아키텍처 설계: CLAUDE.md 프로토콜
CLI가 에이전트의 '신체'라면, CLAUDE.md는 '뇌'에 해당한다. 이 파일은 모든 세션 시작 시 Claude가 자동으로 로드하는 시스템 프롬프트이자 장기 기억 저장소이다.8 일반적인 코딩 에이전트의 경우 이 파일에 코드 스타일 가이드를 포함시키지만, 헤드리스 DevOps 엔지니어를 위해서는 엄격한 운영 프로토콜, 안전 제약 조건, 그리고 인프라에 대한 도메인 지식을 포함시켜야 한다.
3.1 페르소나(Persona) 정의 및 역할 부여
CLAUDE.md는 에이전트의 역할을 명확히 정의하여 '정체성 표류(Identity Drift)'를 방지해야 한다. DevOps 엔지니어 역할을 맡은 에이전트가 쿠버네티스 유지보수 업무 중에 갑자기 프론트엔드 React 코드를 수정하려 해서는 안 된다.
연구 통찰: 구체적인 페르소나(예: "시니어 사이트 신뢰성 엔지니어(SRE)")를 정의하는 것이 모델의 훈련 데이터 중 해당 기술 도메인에 특화된 지식을 활성화하여 산출물의 품질을 높인다는 실증적 증거가 있다.10
DevOps 특화 CLAUDE.md 구성 예시:
Role Definition (역할 정의)
당신은 인프라의 안정성, 보안, 확장성을 책임지는 헤드리스 DevOps 엔지니어입니다.
* 주요 목표: 99.99%의 가용성(Uptime) 유지.
* 부차 목표: 반복적인 운영 작업(Toil)의 자동화.
* 절대 제약: 명시적인 'override' 승인 없이는 env=prod 태그가 붙은 리소스에 대해 파괴적인 명령어(rm, destroy, drop)를 실행할 수 없습니다.
Operational Protocols (운영 프로토콜)
1. 멱등성 (Idempotency): 당신이 작성하는 모든 쉘 스크립트와 테라폼 설정은 멱등성을 가져야 합니다. 즉, 여러 번 실행해도 결과가 동일해야 합니다.
2. 검증 (Verification): terraform apply를 실행하기 전 반드시 terraform plan을 실행하고 그 출력을 분석해야 합니다.
3. 로깅 (Logging): 상태를 변경하는 명령어를 실행하기 전, ops-log.md 파일에 당신의 추론 과정과 계획을 기록하십시오.
3.2 지식 주입(Knowledge Injection): 인프라 표준화
CLAUDE.md는 에이전트가 전체 저장소를 스캔하지 않고도 인프라 구조를 '알 수 있도록' 지식을 주입하는 메커니즘을 제공한다. 이는 토큰 사용량을 줄이고 응답 지연 시간을 단축시키는 데 기여한다.
DevOps 구성을 위해 포함해야 할 핵심 요소는 다음과 같다:
* 디렉토리 구조 매핑: 테라폼 모듈, 앤서블 플레이북, 헬름(Helm) 차트가 위치한 정확한 경로를 명시한다.
* 툴체인(Toolchain) 명세: 도구의 버전을 고정한다(예: "우리는 Terraform v1.5.0과 Kubernetes v1.29를 사용함"). 이는 에이전트가 호환되지 않는 최신 문법이나 이미 폐기된(deprecated) 문법을 사용하는 것을 방지한다.12
* 시크릿 관리(Secret Management): 보안 원칙을 주입한다(예: "절대 시크릿을 stdout으로 출력하지 말 것. 반드시 vault read를 사용하여 애플리케이션 파이프라인으로 전달할 것").
3.3 컨텍스트 계층 구조 및 핸드셰이크 프로토콜
설정의 계층 구조를 이해하는 것은 매우 중요하다. CLAUDE.md는 프로젝트 수준의 컨텍스트를 제공하지만, 프롬프트의 명시적 지시에 의해 오버라이드될 수 있다. 그러나 일반적인 모델의 기본 훈련 데이터보다는 우선순위를 갖는다.
복잡한 폴리 에이전트(Poly-Agent) 워크플로우를 지원하기 위해, CLAUDE.md는 **핸드셰이크 프로토콜(Handshake Protocol)**을 포함해야 한다. 이는 헤드리스 DevOps 에이전트가 다른 에이전트(예: 프론트엔드 에이전트, QA 에이전트)와 어떻게 상호작용하는지를 정의한다.
핸드셰이크 프로토콜 예시:
"만약 빌드 로그 분석 중 프론트엔드 관련 오류(JavaScript/TypeScript 컴파일 에러)를 발견하면, 직접 수정하려 하지 마십시오. 대신 issues/frontend-report.json 형식으로 상세 버그 리포트를 생성하고 세션을 종료하십시오. 이 파일은 '프론트엔드 에이전트'를 트리거하는 신호로 사용됩니다.".14
4. 구성 및 거버넌스: config.json과 settings.json 설정
CLAUDE.md가 '소프트'한 지침을 다룬다면, config.json (및 settings.json)은 런타임 환경의 '하드'한 제약 조건을 강제한다. 이곳은 헤드리스 에이전트의 보안 경계선(Security Boundary)이 코드화되는 곳이다.
4.1 권한 관리 및 도구 허용 목록 (Allow-Listing)
헤드리스 환경에서 에이전트는 권한을 요청할 수 없다. 따라서 권한 설정은 '필요하지만 충분한(Necessary but Sufficient)' 수준으로 사전에 구성되어야 한다. 일반적인 에이전트 도구들이 "Turbo" 모드나 "Auto" 모드를 통해 모든 명령을 허용하는 경향이 있지만, 프로덕션 DevOps 환경에서는 세밀한 화이트리스트(Allow-list) 방식이 필수적이다.15
DevOps를 위한 권장 settings.json 구조:


JSON




{
 "permissions": {
   "allowList": [
     "bash:git status",
     "bash:git add *",
     "bash:git commit*",
     "bash:terraform plan",
     "bash:kubectl get*",
     "bash:docker ps",
     "bash:./scripts/safe-*"
   ],
   "denyList": [
     "bash:rm -rf /",
     "bash:terraform destroy -auto-approve",
     "bash:kubectl delete ns production",
     "bash:git push --force"
   ]
 },
 "auto_execute": true,
 "timeout": "300s",
 "outputStyle": "json"
}

이 설정은 에이전트가 시스템 상태를 관찰(get, plan, status)하고 변경 사항을 스테이징(add, commit)하는 것은 자유롭게 허용하지만, 치명적인 파괴 행위는 명시적으로 차단한다. 특히 denyList는 AI의 확률적 오류로부터 시스템을 보호하는 최후의 보루 역할을 한다.
4.2 속도 제한 및 비용 관리 (Cost Management)
헤드리스 에이전트는 피드백 루프에 빠질 위험이 있다. 예를 들어, 명령어를 실행하고 오류가 발생하면, 다시 시도하고 동일한 오류를 겪는 과정을 무한히 반복하여 API 크레딧을 급격히 소진할 수 있다.
config.json 또는 글로벌 사용자 설정(~/.claude/settings.json)에서 max_turns나 토큰 예산 한도를 설정하는 것은 백그라운드 프로세스의 폭주를 막는 안전망이다.2
4.3 출력 스타일링 및 구조화된 로깅
오케스트레이션 파이프라인에 통합되기 위해, 에이전트의 출력은 인간이 읽기 좋은 '대화체'가 아니라 기계가 파싱 가능한 '구조화된 데이터'여야 한다. outputStyle 설정을 조정하거나 CLI 플래그를 통해 JSON 출력을 강제해야 한다.
통찰(Insight): output-format을 stream-json으로 설정하면, 에이전트의 실시간 사고 과정(Chain of Thought)을 Splunk나 Datadog과 같은 로그 집계 시스템으로 직접 파이핑할 수 있다. 이는 AI 에이전트의 행동을 시스템 로그처럼 모니터링하고 감사(Audit)할 수 있게 해준다.2
5. 신경망 연결: 모델 컨텍스트 프로토콜 (MCP) 통합
모델 컨텍스트 프로토콜(MCP)은 텍스트 기반 LLM을 기능적인 DevOps 엔지니어로 변모시키는 결정적인 기술이다. MCP를 통해 Claude Code는 표준화된 인터페이스를 통해 외부 시스템(AWS, GitHub, Postgres, Sentry)과 안전하게 연결된다.16
5.1 MCP 클라이언트로서의 Claude Code
DevOps 컨텍스트에서 Claude Code는 주로 클라이언트 역할을 수행하며 다양한 MCP 서버로부터 기능을 소비한다. 이를 통해 에이전트는 단순히 Git에 체크인된 코드 너머의 인프라 '상태(State)'를 볼 수 있게 된다.
* GitHub MCP 서버: 에이전트가 gh CLI를 직접 호출하지 않고도 이슈를 읽고, PR 상태를 확인하며, 코드 리뷰에 코멘트를 달 수 있게 한다.
* Postgres/Database MCP 서버: 배포 중 데이터베이스 스키마를 쿼리하거나 활성 연결을 확인하여, 마이그레이션을 방해하는 테이블 락(Table Lock)이 없는지 검사한다.18
* 클라우드 공급자 MCP (AWS/GCP): AWS CLI 명령어를 환각(Hallucination)으로 만들어내는 대신, 정의된 MCP 도구를 통해 EC2 인스턴스 목록을 조회하거나 CloudWatch 로그를 검색한다.
구현 전략:
이를 구성하기 위해 mcp_config.json 파일에 필요한 도구들의 연결 정보를 정의해야 한다.


JSON




{
 "mcpServers": {
   "github": {
     "command": "npx",
     "args": ["-y", "@modelcontextprotocol/server-github"]
   },
   "aws-monitor": {
     "command": "python",
     "args": ["/opt/mcp/aws-monitor.py"],
     "env": {
       "AWS_PROFILE": "devops-bot"
     }
   }
 }
}

이 구성을 통해 헤드리스 에이전트는 "지난 배포 시점의 CloudWatch 로그를 확인하고, 해당 시점의 GitHub 커밋과 교차 검증하라"는 명령을 수행할 때, 연결된 MCP 도구들을 활용하여 정확한 데이터를 조회할 수 있다.19
5.2 MCP 서버로서의 Claude Code (역방향 연결)
간과하기 쉽지만 매우 중요한 기능은 Claude Code 자체가 MCP 서버로 구동될 수 있다는 점이다 (claude mcp serve). 이는 관계를 역전시킨다. 이 모드에서는 마스터 오케스트레이터(Google Antigravity 또는 커스텀 운영 대시보드)가 Claude Code를 하나의 '도구'로서 호출한다.7
아키텍처적 함의: 계층적 에이전트 구조 (Hierarchical Agent Structure)
1. Antigravity (Mission Control): 프로젝트 전체를 조망하는 최상위 에이전트.
2. Claude Code (DevOps MCP): Antigravity가 사용할 수 있는 전문화된 도구. Antigravity가 "이 변경사항을 배포해야 해"라고 결정하면, Claude Code 프로세스에 MCP 요청을 보낸다.
3. 실행 (Execution): Claude Code는 요청을 수신하고, 자신의 DevOps 전용 CLAUDE.md를 로드하여 배포를 수행한 후 결과를 반환한다.
이러한 캡슐화는 소프트웨어 엔지니어링의 '관심사의 분리(Separation of Concerns)' 원칙을 준수한다. '코딩 에이전트'(Antigravity)는 테라폼 문법을 알 필요 없이, 단지 'DevOps 에이전트'(Claude)에게 "배포해"라고 요청하는 방법만 알면 된다.7
6. 오케스트레이션 환경: Google Antigravity와 미션 컨트롤
Google Antigravity는 '에이전트 우선(Agent-First)' 패러다임을 표방하며, 기존 IDE의 한계를 넘어선 '미션 컨트롤(Mission Control)' 인터페이스를 제공한다.22 이는 다중 에이전트를 시각적으로 관리하고 오케스트레이션하는 중앙 지휘소 역할을 한다.
6.1 미션 컨트롤 내 Claude Code 통합 전략
Antigravity는 기본적으로 Google의 Gemini 모델을 사용하지만, 외부 에이전트와의 통합을 지원한다. Claude Code를 Antigravity의 폴리 에이전트 워크플로우에 통합하기 위해서는 교차 표면(Cross-Surface) 에이전트 전략을 사용해야 한다.
* 통합 포인트: Antigravity 에이전트는 터미널 명령을 실행할 수 있는 권한을 가진다. 따라서 Antigravity의 '매니저' 에이전트에게 쉘 명령어를 통해 Claude Code 세션을 *스폰(Spawn)*하도록 지시할 수 있다.
* 워크플로우:
   1. 사용자 (Antigravity): "새로운 사용자 서비스 배포를 시작해."
   2. Antigravity 에이전트: 작업을 분석하고 이것이 DevOps 영역임을 인지한다.
   3. Antigravity 에이전트: 터미널에서 claude -p "테라폼을 사용하여 사용자 서비스 배포 계획 수립" --allowedTools "All" 명령을 실행한다.
   4. Claude Code (헤드리스): 백그라운드에서 기동되어 CLAUDE.md를 읽고, 테라폼 계획을 실행하고, MCP를 통해 검증한 후 결과를 JSON으로 출력하고 종료한다.
   5. Antigravity 에이전트: Claude가 출력한 JSON 결과를 읽고, 사용자에게 "배포 계획이 수립되었습니다. 승인하시겠습니까?"라고 보고한다.22
이 구조는 Claude Code를 Antigravity '매니저'의 전문 하청업체(Sub-contractor)로 효과적으로 변환시킨다.
7. 협업 메커니즘: 폴리 에이전트 간 동기화 기술
Claude Code가 Antigravity 내의 다른 에이전트(예: '프론트엔드 개발자')와 동시에 작업할 때, 파일 시스템(Git)을 공유하므로 경합 조건(Race Condition)이 발생할 위험이 크다. 프론트엔드 에이전트가 package.json을 수정하는 동안 DevOps 에이전트가 npm install을 실행하면 빌드는 실패할 것이다. 이를 해결하기 위한 정교한 동기화 기술이 필요하다.
7.1 Git 워크트리(Worktree) 패턴을 통한 격리
파일 충돌 없이 DevOps 에이전트와 코딩 에이전트가 동시에 작업할 수 있도록 Git Worktree를 활용해야 한다.
* 메인 워크트리 (Main Worktree): 인간 개발자나 Antigravity 코딩 에이전트가 기능 개발을 위해 사용한다.
* Ops 워크트리 (Ops Worktree): 동일한 저장소를 체크아웃한 병렬 디렉토리(예: ../project-ops)이다.
* Claude의 영토: 헤드리스 DevOps 에이전트는 오직 Ops 워크트리에서만 작동하도록 설정된다.
통찰: 이 패턴은 DevOps 에이전트가 메인 폴더에서 일어나는 활발한 개발 활동과 완전히 격리된 채, 별도의 브랜치와 폴더에서 "쿠버네티스 클러스터 업그레이드"와 같은 장기 실행 작업을 수행할 수 있게 한다. 작업이 완료되면 Claude는 PR을 생성하고, 메인 에이전트가 이를 리뷰한다.12
7.2 파일 기반 뮤텍스(Mutex) 잠금 메커니즘
서로 다른 프로세스(또는 컨테이너)에서 실행되는 에이전트 간의 상태 공유를 위해 파일 기반의 락(Lock) 시스템을 구현해야 한다. 쉘 스크립트 기반의 flock이나 디렉토리 존재 유무를 활용한 원자적(Atomic) 잠금이 효과적이다.28
에이전트 락(Agent Lock) 프로토콜:
1. 획득 시도: DevOps 에이전트가 상태 변경 작업(예: terraform apply)을 시작하기 전, .agent/lock 파일 획득을 시도한다.
2. 대기 (Backoff): 만약 락 파일이 존재하면, 에이전트는 일정 시간 대기(Sleep)하거나 작업을 재스케줄링한다.
3. 점유: 락을 획득하면 자신의 프로세스 ID와 작업 의도("Running Terraform Apply")를 파일에 기록한다.
4. 해제: 작업 완료 후 즉시 락을 삭제한다.
CLAUDE.md에 다음과 같은 지침을 추가하여 이를 강제할 수 있다:
"쓰기 작업을 수행하기 전, 반드시 .agent/lock의 존재를 확인하십시오. 존재한다면 대기하고, 없다면 생성한 후 작업을 수행하고 즉시 삭제하십시오.".5
8. 네이티브 훅(Hooks)과 이벤트 기반 자동화
Claude Code의 hooks 모듈은 에이전트의 행동 전후에 스크립트를 결정론적(Deterministic)으로 실행할 수 있게 해준다. 이는 헤드리스 역할에서 규정 준수(Compliance)를 강제하는 핵심 장치이다.32
8.1 사전 명령 검증 (Pre-Command Validation) - "안전 장치"
PreToolUse 훅은 에이전트가 도구를 실행하기 직전에 개입하여 명령을 가로챌 수 있다. 이는 DevOps 에이전트의 최후 방어선이다.
훅 설정 예시 (.claude/hooks.json):


JSON




{
 "hooks":
}

validate_command.sh 스크립트는 정규 표현식(Regex)을 사용하여 금지된 명령어 패턴(예: force push, drop table)이 감지되면, LLM이 실행을 결정했더라도 이를 강제로 차단하고 에러를 반환한다. 이는 AI의 확률적 본성을 코드화된 규칙으로 제어하는 것이다.34
8.2 사후 로깅 및 알림 (Post-Command Logging)
PostToolUse 훅은 관측가능성(Observability)을 위해 사용된다. 헤드리스 DevOps 에이전트가 성공적으로 파일을 수정하거나 배포 명령을 실행할 때마다, 이 훅이 알림 스크립트를 트리거한다.
* 유스케이스: Claude가 kubectl apply를 실행하여 배포를 완료하면, 사후 훅이 그 출력을 캡처하여 웹훅(Webhook)을 통해 슬랙(Slack) 채널로 전송한다. 이를 통해 운영팀은 "헤드리스" 에이전트가 무엇을 했는지 실시간으로 파악할 수 있다.32
9. 보안 아키텍처 및 신뢰 계층 (Trust Layer)
쓰기 권한을 가진 헤드리스 에이전트를 배포하는 것은 고위험 작업이다. 보안은 사후 고려사항이 아닌 아키텍처의 근간이어야 한다.
9.1 식별 및 접근 관리 (IAM)
헤드리스 Claude는 개인 사용자의 자격 증명이 아닌, 전용 서비스 계정(Service Account) 또는 IAM 사용자 권한으로 실행되어야 한다.
* 최소 권한 원칙 (Least Privilege): 필요한 리소스에만 접근 권한을 부여한다. (예: 개발용 S3 버킷에는 FullAccess, 프로덕션 버킷에는 ReadOnly).
* 감사 로깅 (Audit Logging): 이 서비스 계정이 수행하는 모든 API 호출은 CloudTrail이나 감사 로그에 별도로 기록되어야 한다. 이를 통해 사고 발생 시 AI의 행위를 추적할 수 있다.
9.2 "인간 개입(Human-in-the-Loop)" 게이트
프로덕션 배포와 같은 민감한 작업에 대해서는 '헤드리스' 모드를 일시 중지하고 인간의 승인을 요구해야 한다.
* 메커니즘: CLAUDE.md를 통해 에이전트가 중요한 결정 지점에서 멈추도록 설정한다.
   * 지침: "만약 Terraform Plan 결과에 'destroy'가 포함되어 있다면, 실행을 중단하고 '승인 대기(Pending Approval)' 아티팩트를 생성하시오."
   * 구현: 파이프라인은 이 아티팩트가 생성되면 실행을 멈추고, 인간 관리자가 내용을 검토한 후 승인 버튼을 눌러야만 작업을 재개한다.
9.3 샌드박싱 (Sandboxing)
가능한 경우, 헤드리스 에이전트는 제한된 네트워크 접근 권한(내부 API 및 특정 퍼블릭 저장소만 허용)을 가진 컨테이너화된 샌드박스(Docker) 내부에서 작동해야 한다. 이는 에이전트가 실수로 민감한 데이터를 외부로 유출하거나(Exfiltration), 외부의 악성 코드를 다운로드하는 것을 방지한다.2
10. 운영 시나리오 (Case Studies)
앞서 논의한 구성 요소들을 통합하여, 실제 헤드리스 DevOps 엔지니어가 수행할 수 있는 구체적인 워크플로우 시나리오를 설계한다.
10.1 시나리오 A: 인프라 드리프트(Drift) 자동 감지 및 복구
목표: 클라우드 인프라에 가해진 승인되지 않은 수동 변경을 감지하고 원상 복구한다.
1. 트리거: 크론(Cron) 작업이 주기적으로 terraform plan -detailed-exitcode를 실행한다. 변경 사항이 감지되어 종료 코드 2가 반환되면, 헤드리스 Claude를 트리거한다.
2. 컨텍스트 로드: Claude는 -p 모드로 초기화되며, CLAUDE.md (DevOps 페르소나)와 mcp_config.json (AWS 접근 권한)을 로드한다.
3. 진단: Claude는 plan 출력을 분석한다. 누군가 보안 그룹(Security Group)을 수동으로 수정하여 22번 포트를 전체 개방(0.0.0.0/0)했음을 식별한다.
4. 추론: CLAUDE.md의 규칙("22번 포트는 절대 전체 개방되어서는 안 된다")에 근거하여 이것이 정책 위반임을 판단한다.
5. 조치: Claude는 terraform apply를 실행하여 상태를 코드 정의대로 되돌린다(Revert).
6. 보고: Claude는 커스텀 도구를 사용하여 Jira에 티켓을 생성하고 보고한다: "보안 그룹 sg-123에 대한 승인되지 않은 변경 사항을 감지하고 복구함."
10.2 시나리오 B: CI/CD 파이프라인 자율 복구 ("The Fixer")
목표: 의존성 업데이트로 인해 깨진 빌드를 자율적으로 수정한다.
1. 트리거: GitHub Actions의 'Test' 단계가 실패한다. 워크플로우는 실패 로그를 인수로 하여 claude -p를 호출한다.
2. 오케스트레이션: 러너 내부에서 실행된 Claude는 로그를 분석한다: Error: Package 'uuid' has no exported member 'v4'.
3. 교차 참조: Claude는 GitHub MCP를 사용하여 package.json의 변경 이력을 확인한다. 최근 uuid 패키지가 메이저 업데이트되었음을 파악한다.
4. 수정: Claude는 소스 코드의 임포트 구문을 import { v4 }에서 새로운 버전에 맞는 문법으로 수정한다.
5. 검증: Claude는 러너 내부에서 로컬로 npm test를 실행하여 수정 사항이 유효한지 확인한다.
6. 커밋: 테스트가 통과하면, Claude는 "fix(deps): update uuid import syntax"라는 메시지로 커밋하고 푸시한다.
10.3 시나리오 C: 오케스트레이션된 기능 배포 (Antigravity + Claude)
목표: Antigravity에서 개발된 신규 기능을 위한 인프라를 프로비저닝하고 배포한다.
1. 미션 컨트롤: Antigravity의 개발자가 작업을 "배포 준비(Ready for Deploy)" 상태로 변경한다.
2. Antigravity 에이전트: 작업을 스캔하고, 새로운 S3 버킷이 필요함을 인지한다.
3. 핸드오프: Antigravity 에이전트는 ops 디렉토리에서 헤드리스 Claude Code 프로세스를 스폰한다.
4. 실행: Claude Code는 S3 버킷을 위한 테라폼 코드를 작성하고, plan 및 apply를 실행한다. 실행 결과로 생성된 bucket_name을 JSON으로 출력한다.
5. 루프백: Antigravity 에이전트는 Claude의 출력에서 bucket_name을 캡처하여, 메인 애플리케이션의 .env 파일을 업데이트한다.
6. 완료: 애플리케이션은 새로운 인프라 설정과 함께 배포되며, 이 모든 과정은 두 전문 에이전트의 협업으로 자동화된다.
11. 결론: 자율 운영 센터를 향한 여정
Claude Code를 헤드리스 DevOps 엔지니어로 구성하는 것은 '자율 주행 데이터 센터(Self-Driving Data Center)'로 나아가는 중요한 진보이다. Claude 3.5/3.7의 강력한 추론 능력과 CLI의 구조적 제어 능력, CLAUDE.md의 기억력, 그리고 MCP의 연결성을 결합함으로써, 우리는 현대 운영 환경의 반복적인 고역(Toil)을 처리할 수 있는 실체를 만들어낼 수 있다.
그러나 성공의 열쇠는 구성의 정교함에 있다. 불명확한 CLAUDE.md는 혼란스러운 에이전트를 만들고, 지나치게 제한된 config.json은 무용지물인 에이전트를 만든다. 본 보고서에서 제안한 아키텍처—--dangerously-skip-permissions를 통한 자율성과 '훅(Hooks)', '뮤텍스 락(Mutex Locks)'을 통한 안전성 사이의 균형—는 견고한 프로덕션 등급의 에이전트 노동력을 구축하기 위한 청사진을 제공한다. Google Antigravity와 같은 도구가 성숙해짐에 따라, 오케스트레이션 계층은 더욱 매끄러워질 것이며, 결국 소프트웨어의 '생성(Creation)'과 '운영(Operation)'이라는 구분된 역할이 하나의 통합된 인지 패브릭(Cognitive Fabric)으로 융합될 것이다.
핵심 권고사항:
1. 작게 시작하라: 처음에는 읽기 전용(Read-only) 모니터링 작업부터 헤드리스 에이전트를 도입하라.
2. CLAUDE.md에 투자하라: 이 파일을 시스템의 가장 중요한 문서이자 코드로서 관리하라.
3. MCP를 적극 도입하라: 내부 도구를 위한 커스텀 MCP 서버를 구축하여 에이전트의 손발을 확장하라.
4. 감시자를 감시하라: 에이전트의 모든 행동을 엄격하게 로깅하여 신뢰를 구축하라.
참고 자료
1. Run Claude Code programmatically - Claude Code Docs, 12월 22, 2025에 액세스, https://code.claude.com/docs/en/headless
2. Claude Code CLI Cheatsheet: config, commands, prompts, + best practices - Shipyard.build, 12월 22, 2025에 액세스, https://shipyard.build/blog/claude-code-cheat-sheet/
3. Claude Code non-interactive tips? : r/ClaudeAI - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1kn53h3/claude_code_noninteractive_tips/
4. CLI reference - Claude Code Docs, 12월 22, 2025에 액세스, https://code.claude.com/docs/en/cli-reference
5. [FEATURE] Add tool alias configuration for modern CLI alternatives · Issue #12375 · anthropics/claude-code - GitHub, 12월 22, 2025에 액세스, https://github.com/anthropics/claude-code/issues/12375
6. Claude Code Spec-Driven Developement : r/ClaudeAI - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1m379oo/claude_code_specdriven_developement/
7. Claude Code as an MCP Server: An Interesting Capability Worth Understanding, 12월 22, 2025에 액세스, https://www.ksred.com/claude-code-as-an-mcp-server-an-interesting-capability-worth-understanding/
8. Claude MD File | Complete Guide with Examples : r/deeplearning - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/deeplearning/comments/1ozfhng/claude_md_file_complete_guide_with_examples/
9. The Complete Guide to Setting Global Instructions for Claude Code CLI - Naqeeb ali Shamsi, 12월 22, 2025에 액세스, https://naqeebali-shamsi.medium.com/the-complete-guide-to-setting-global-instructions-for-claude-code-cli-cec8407c99a0
10. CLAUDE MD DevOps · ruvnet/claude-flow Wiki - GitHub, 12월 22, 2025에 액세스, https://github.com/ruvnet/claude-flow/wiki/CLAUDE-MD-DevOps
11. Claude Code: AI Agent for DevOps, SRE, and Platform Engineering - YouTube, 12월 22, 2025에 액세스, https://www.youtube.com/watch?v=h-6LP133o6w
12. Claude Code: Best practices for agentic coding - Anthropic, 12월 22, 2025에 액세스, https://www.anthropic.com/engineering/claude-code-best-practices
13. A Brief Guide to Setting Up Claude Code from Scratch : r/ClaudeAI - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1mx255o/a_brief_guide_to_setting_up_claude_code_from/
14. We prepared a collection of Claude code subagents for production-ready workflows. : r/ClaudeAI - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1mi59yk/we_prepared_a_collection_of_claude_code_subagents/
15. Tutorial : Getting Started with Google Antigravity | by Romin Irani - Medium, 12월 22, 2025에 액세스, https://medium.com/google-cloud/tutorial-getting-started-with-google-antigravity-b5cc74c103c2
16. Antigravity Editor: MCP Integration, 12월 22, 2025에 액세스, https://antigravity.google/docs/mcp
17. Introducing the Model Context Protocol - Anthropic, 12월 22, 2025에 액세스, https://www.anthropic.com/news/model-context-protocol
18. Connect Google Antigravity IDE to Google's Data Cloud services, 12월 22, 2025에 액세스, https://cloud.google.com/blog/products/data-analytics/connect-google-antigravity-ide-to-googles-data-cloud-services
19. Claude Code (CLI) | docs - Trunk Platform, 12월 22, 2025에 액세스, https://docs.trunk.io/ci-autopilot/overview/use-mcp-server/configuration/claude-code-cli
20. Connect Claude Code to tools via MCP, 12월 22, 2025에 액세스, https://code.claude.com/docs/en/mcp
21. Compare Cursor vs. Google Antigravity vs. Windsurf Editor in 2025 - Slashdot, 12월 22, 2025에 액세스, https://slashdot.org/software/comparison/Cursor-vs-Google-Antigravity-vs-The-Windsurf-Editor/
22. Getting Started with Google Antigravity, 12월 22, 2025에 액세스, https://codelabs.developers.google.com/getting-started-google-antigravity
23. Google Antigravity AI - What is it?, 12월 22, 2025에 액세스, https://cension.ai/blog/google-antigravity-ai-what-is-it/
24. Build with Google Antigravity, our new agentic development platform, 12월 22, 2025에 액세스, https://developers.googleblog.com/build-with-google-antigravity-our-new-agentic-development-platform/
25. Google Joins AI IDE Race to Compete with VS Code, Apparently Forking VS Code, 12월 22, 2025에 액세스, https://visualstudiomagazine.com/articles/2025/11/20/google-joins-ai-ide-race-to-compete-with-vs-code-apparently-forking-vs-code.aspx
26. I built a CLI tool that lets Claude Code automatically solve your GitHub issues - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1po1dso/i_built_a_cli_tool_that_lets_claude_code/
27. Mastering Git Worktrees with Claude Code for Parallel Development Workflow - Medium, 12월 22, 2025에 액세스, https://medium.com/@dtunai/mastering-git-worktrees-with-claude-code-for-parallel-development-workflow-41dc91e645fe
28. January 2018 - scm-commits - Fedora mailing-lists - Available lists, 12월 22, 2025에 액세스, https://lists.pagure.io/archives/list/scm-commits@lists.fedoraproject.org/2018/1/?count=200&page=6
29. bash - Is there any mutex/semaphore mechanism in shell scripts? - Stack Overflow, 12월 22, 2025에 액세스, https://stackoverflow.com/questions/6870221/is-there-any-mutex-semaphore-mechanism-in-shell-scripts
30. Lock your script (against parallel execution) - The Bash Hackers Wiki, 12월 22, 2025에 액세스, https://bash-hackers.gabe565.com/howto/mutex/
31. claude-camille - npm Package Security Analysis - Socket.dev, 12월 22, 2025에 액세스, https://socket.dev/npm/package/claude-camille
32. Claude Code Hooks: What is and How to Use It - CometAPI - All AI Models in One API, 12월 22, 2025에 액세스, https://www.cometapi.com/claude-code-hooks-what-is-and-how-to-use-it/
33. Get started with Claude Code hooks, 12월 22, 2025에 액세스, https://code.claude.com/docs/en/hooks-guide
34. How I use Claude Code (+ my best tips) - Builder.io, 12월 22, 2025에 액세스, https://www.builder.io/blog/claude-code
35. Claude Code now supports hooks : r/ClaudeAI - Reddit, 12월 22, 2025에 액세스, https://www.reddit.com/r/ClaudeAI/comments/1loodjn/claude_code_now_supports_hooks/
36. Slash commands - Claude Code Docs, 12월 22, 2025에 액세스, https://code.claude.com/docs/en/slash-commands